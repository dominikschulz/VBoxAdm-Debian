user = postfix
password = PASSWORD
hosts = localhost
dbname = vboxadm
query = /* virtual_alias_maps.cf */ /* direct alias */ SELECT goto FROM aliases AS a LEFT JOIN domains AS d ON a.domain_id = d.id WHERE d.name = '%d' AND a.local_part = '%u' AND a.is_active AND d.is_active UNION /* role account */ SELECT CONCAT(local_part,'@',domain) AS goto FROM role_accounts WHERE name = '%u' AND NOT (local_part = '%u' AND domain = '%d') UNION /* direct alias + mailbox */ SELECT CONCAT(m.local_part,'@',d.name) FROM aliases AS a LEFT JOIN domains AS d ON a.domain_id = d.id LEFT JOIN mailboxes AS m ON m.domain_id = d.id WHERE d.name = '%d' AND a.local_part = '%u' AND a.is_active AND d.is_active AND m.local_part = a.local_part UNION /* virtual_alias_domain_maps.cf */ SELECT goto FROM aliases AS a LEFT JOIN domains AS d ON a.domain_id = d.id LEFT JOIN domain_aliases AS da ON da.domain_id = d.id WHERE da.name = '%d' AND a.local_part = '%u' AND a.is_active AND d.is_active AND da.is_active UNION /* virtual_alias_domain_mailbox_maps.cf */ SELECT CONCAT(m.local_part,'@',d.name) AS goto FROM domains AS d LEFT JOIN mailboxes AS m ON m.domain_id = d.id LEFT JOIN domain_aliases AS da ON da.domain_id = d.id WHERE da.name = '%d' AND m.local_part = '%u' AND d.is_active AND m.is_active UNION /* virtual_vacation_alias_maps.cf */ SELECT CONCAT(ma.local_part,'@',d.name,',',ma.local_part,'#',d.name,'@autoreply.domain.tld') AS goto FROM mailboxes AS ma LEFT JOIN domains AS d ON ma.domain_id = d.id WHERE ma.is_on_vacation AND d.name = '%d' AND ma.local_part = '%u' AND (ma.vacation_start = '0000-00-00' OR NOW() >= ma.vacation_start) AND (ma.vacation_end = '0000-00-00' OR ma.vacation_end >= NOW())
